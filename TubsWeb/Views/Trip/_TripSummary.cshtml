@model Spc.Ofp.Tubs.DAL.Entities.Trip

<table class="table table-striped table-bordered table-condensed">
    <tr>
        <td>Observer:</td>
        <td>@Model.Observer.ToString()</td>
        <td>Program:</td>
        <td>@Model.ProgramCode</td>
    </tr>
    <tr>
        <td>Trip Number:</td>
        <td>@Model.TripNumber</td>
        <td>Alternate Trip Number:</td>
        <td>@Model.AlternateTripNumber</td>
    </tr>
    <tr>
        <td>First Day:</td>
        <td>@Html.DisplayFor(m => m.DepartureDate)</td>
        <td>Last Day:</td>
        <td>@Html.DisplayFor(m => m.ReturnDate)</td>
    </tr>
    <tr>
        <td>Vessel Name:</td>
        <td>@Html.DisplayFor(m => m.Vessel.Name)</td>
        <td>Vessel Flag:</td>
        <td>
            @if (!String.IsNullOrEmpty(Model.Vessel.RegisteredCountryCode))
            {
                var imgLink = @Url.Content(String.Format("~/Content/images/flags/{0}.png", Model.Vessel.RegisteredCountryCode.ToLower()));
                <img src="@imgLink" alt="@Model.Vessel.RegisteredCountryCode" title="@Model.Vessel.RegisteredCountryCode" /> @:&nbsp;
            }
            @Html.DisplayFor(m => m.Vessel.RegisteredCountryCode)
        </td>
    </tr>
    <tr>
        <td>Departure Port:</td>
        <td>@Model.DeparturePort.ToString()</td>
        <td>Return Port:</td>
        <td>@Model.ReturnPort.ToString()</td>
    </tr>
    <!-- Add Sea days and sets for PS trips -->
    @if (Model.GetType() == typeof(Spc.Ofp.Tubs.DAL.Entities.PurseSeineTrip))
    {
        var pstrip = Model as Spc.Ofp.Tubs.DAL.Entities.PurseSeineTrip;
        <tr>
            <td>Sea Days:</td>
            <td>
                @pstrip.SeaDays.Count.ToString()
                @if (pstrip.DepartureDate.HasValue && pstrip.ReturnDate.HasValue)
                {
                    var dateDiff = pstrip.DepartureDate.Value.Subtract(pstrip.ReturnDate.Value);
                    string suffix = ((int)Math.Abs(dateDiff.TotalDays)).ToString();
                    @: / @suffix
                }
            </td>
            <td>Sets:</td>
            @{
                var setcount = (
                    from d in pstrip.SeaDays
                    from a in d.Activities
                    where a.ActivityType.HasValue && a.ActivityType.Value == Spc.Ofp.Tubs.DAL.Common.ActivityType.Fishing
                    select 1
                ).Sum();                              
            }
            <td>@setcount</td>
        </tr> 
    }  
    
    @if (Model.IsSpillSampled.HasValue && Model.IsSpillSampled.Value)
    {
    <tr>
        <td>Spill Observer:</td>
        <td>TODO</td>
        <td>Spill Trip Number:</td>
        <td>@Html.DisplayFor(m => m.SpillTripNumber)</td>
    </tr>
    }
    <tr>
        <td>Entered By:</td>
        <td>@Model.EnteredBy</td>
        <td>Entered Date:</td>
        <td>@Html.DisplayFor(m => m.EnteredDate)</td>
    </tr>
    @if (Model.ClosedDate.HasValue)
    {
    <tr>
        <td>Closed Date:</td>
        <td>@Html.DisplayFor(m => m.ClosedDate)</td>
        <td>Entry Comments:</td>
        <td>
            @* TODO:  Replace existing expansion code with this. *@
            @* http://dotdotdot.frebsite.nl/ *@
            <div class="large-text">
                @Html.DisplayFor(m => m.Comments)
            </div>
        </td>
    </tr>
    }
    @* TODO Add verified information *@
</table>