@model Spc.Ofp.Tubs.DAL.Entities.Trip
@using Spc.Ofp.Tubs.DAL.Entities
@using Spc.Ofp.Tubs.DAL.Common

<h2>@ViewBag.Title</h2>

<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.min.js")" type="text/javascript"></script>

@* TODO Should we enable edits directly in the table too? *@
<fieldset>
    <legend>Page Counts</legend>
    @{ Html.RenderPartial("_PageCounts", Model.PageCounts); }
</fieldset>

@if (!Model.IsReadOnly)
{
    @* Passing the argument to 'done' requires the String.Format call *@
    @* http://stackoverflow.com/questions/6550290/ajaxoptions-onsuccess-callback-with-parameter-not-working *@
    var options = new AjaxOptions { HttpMethod = "Post", UpdateTargetId = "pageCounts", OnSuccess = String.Format("clearForm('#{0}')", "addPageCountForm") };
    // Drop down list of form types should be valid for trip type
    var formNames =
        from FormNames fm in Enum.GetValues(typeof(FormNames))
        select new { ID = fm, Name = fm.GetDescription() };
    var formNameList = new SelectList(formNames, "ID", "Name");
    
    using (Ajax.BeginForm("AddPageCount", null, options, new { id = "addPageCountForm" }))
    {
        @Html.ValidationSummary(false)
        <fieldset>
            <legend>Add Page Count</legend>
            @{ var pageCount = new PageCount(); }
            @Html.HiddenFor(m => pageCount.Id)

            @Html.LabelFor(m => pageCount.FormName)
            @Html.DropDownListFor(m => pageCount.FormName, formNameList)
            @Html.ValidationMessageFor(m => pageCount.FormName) <br />

            @Html.LabelFor(m => pageCount.FormCount)
            @Html.TextBoxFor(m => pageCount.FormCount)
            @Html.ValidationMessageFor(m => pageCount.FormCount) <br />

            <p>
                <input type="Submit" value="Add" style="font-size: 1.0em;"/>
                <input type="Reset" value="Cancel" style="font-size: 1.0em;"/>
            </p>
        </fieldset>
    }
}