//v2.0.2 - C 2013, Dave Herren, License: MIT 
(function(){function w(a,g){var d=a?a[g.full]||a[g.parent]||a[g.name]||{}:{};k&&k(g,d,a);return d}function m(a){return null===a||void 0===a}function q(a){return null===a||void 0===a||a.constructor===String||a.constructor===Number||a.constructor===Boolean||a instanceof Date}function n(a,g,d,c){var e,b,f,l,j,h;c=c||w(g,d);var k;if(e=c.custom)h=!0,"function"===typeof e?b=e(a):(b=e.map(a),m(b)||(b.___$mapCustom=e.map,e.unmap&&(b.___$unmapCustom=e.unmap)));else if(c.append)h=!0,b=a;else{if(c.exclude)return h=
!0,r;if(q(a))b=d.parentIsArray?a:y(a);else if(a instanceof Array){b=[];f=0;for(e=a.length;f<e;f++)b[f]=n(a[f],g,{name:"[i]",parent:d.name+"[i]",full:d.full+"[i]",parentIsArray:!0});if(!d.parentIsArray||x){l={name:"[i]",parent:d.name+"[i]",full:d.full+"[i]",parentIsArray:!0};b=z(b);if(a=c.arrayChildId)b.___$childIdName=a;b.pushFromModel=function(a){a=n(a,g,l);b.push(a)};b.unshiftFromModel=function(a){a=n(a,g,l);b.unshift(a)};b.popToModel=function(a){a=b.pop();return p(a,l)};b.shiftToModel=function(a){a=
b.shift();return p(a,l)}}}else if(a.constructor===Object)for(f in b={},a)l={name:f,parent:("[i]"===d.name?d.parent:d.name)+"."+f,full:d.full+"."+f},k=a[f],(e=q(k)?w(g,l):void 0)&&e.custom?(b.___$customChildren=b.___$customChildren||{},b.___$customChildren[f]=e.custom,b[f]="function"===typeof e.custom?e.custom(a[f]):e.custom.map(a[f])):(e=n(k,g,l,e),e!==r&&(b[f]=e))}if(!h&&(j=c.extend))"function"===typeof j?b=j(b)||b:j.constructor===Object&&("function"===typeof j.map&&(b=j.map(b)||b),"function"===
typeof j.unmap&&(b.___$unmapExtend=j.unmap));return b}function p(a,g){var d,c,e,b=s(a),f;f=a!==b;k&&k(g);if(!f&&a&&a.constructor===Function)return r;if(a&&a.___$unmapCustom)d=a.___$unmapCustom(a);else if(f&&q(b)||m(b))d=b;else if(b instanceof Array){d=[];c=0;for(e=b.length;c<e;c++)d[c]=p(b[c],{name:"[i]",parent:g.name+"[i]",full:g.full+"[i]"})}else if(b.constructor===Object)for(c in d={},b){if("___$"!==c.substr(0,4))if(a.___$customChildren&&a.___$customChildren[c]&&a.___$customChildren[c].unmap)d[c]=
a.___$customChildren[c].unmap(b[c]);else if(f=b[c],!ko.isComputed(f)&&!((e=s(f))&&e.constructor===Function))f=p(f,{name:c,parent:("[i]"===g.name?g.parent:g.name)+"."+c,full:g.full+"."+c}),f!==r&&(d[c]=f)}else!f&&"function"!==typeof b&&(d=b);a&&a.___$unmapExtend&&(d=a.___$unmapExtend(d,a));return d}function t(a,g,d){var c,e,b,f,l,j,h=s(g);e=g!==h;k&&k(d);if(e&&m(h)^m(a))g(a);else if(a&&h&&h.constructor==Object&&a.constructor===Object)for(c in a)g.___$customChildren&&g.___$customChildren[c]?(b=g.___$customChildren[c].map||
g.___$customChildren[c],h[c]=b(a[c])):(b=h[c],!e&&h.hasOwnProperty(c)&&(q(b)||b&&b.constructor===Array)?h[c]=a[c]:b&&"function"===typeof b.___$mapCustom?A(b)?(f=b.___$mapCustom(a[c]),f=s(f),b(f)):h[c]=h[c].___$mapCustom(a[c]):m(a[c])&&h[c]&&h[c].constructor===Object?h[c]=a[c]:t(a[c],h[c],{name:c,parent:("[i]"===d.name?d.parent:d.name)+"."+c,full:d.full+"."+c},h));else if(h&&h instanceof Array)if(j=g.___$childIdName){f=[];for(c=a.length-1;0<=c;c--){b=!1;l=a[c][j];for(e=h.length-1;0<=e;e--)if(l===h[e][j]()){t(a[c],
h[e],{name:"[i]",parent:d.name+"[i]",full:d.full+"[i]"});b=!0;f[e]=!0;break}b||g.splice(c,1)}for(c=a.length-1;0<=c;c--)f[c]||g.pushFromModel(a[c])}else if(e=[],h=g.___$mapCustom,"function"===typeof h){c=0;for(d=a.length;c<d;c++)e[c]=a[c];g(h(e))}else{g(e);c=0;for(d=a?a.length:0;c<d;c++)g.pushFromModel(a[c])}else e&&g(a)}function u(a,g){x=a.makeChildArraysObservable;window.console&&a.logging?(console.log(g),k=function(a,c,e){console.log("- "+(c&&c.settingType?c.settingType+" "+a.full+" (matched: '"+
((e[a.full]?a.full:"")||(e[a.parent]?a.parent:"")||a.name)+"')":"default "+a.full))}):k=void 0}var s=ko.utils.unwrapObservable,A=ko.isObservable,y=ko.observable,z=ko.observableArray,v={name:"{root}",parent:"{root}",full:"{root}"},k,x,r=function(){};ko.viewmodel={options:{makeChildArraysObservable:!0,logging:!1},fromModel:function(a,g){var d={},c=g?g.shared||{}:{},e,b,f,l,j,h,k;for(j in g)if(e=g[j]||{},"shared"!==j)if(e instanceof Array){b=0;for(l=e.length;b<l;b++)f=e[b],d[f]=d[f]||{},d[f][j]=!0,d[f].settingType=
d[f].settingType?"multiple":j}else if(e.constructor===Object)for(f in e){d[f]=d[f]||{};b=e[f];if((b="arrayChildId"!==j&&b&&b.constructor===String&&c[b]?c[b]:b)&&b.constructor===Object)for(h in b)if((k=b[h])&&k.constructor==String&&c[k])b[h]=c[k];d[f][j]=b;d[f].settingType=d[f].settingType?"multiple":j}u(this.options,"Mapping From Model");return n(a,d,v)},toModel:function(a){u(this.options,"Mapping To Model");return p(a,v)},updateFromModel:function(a,g){u(this.options,"Update From Model");return t(g,
a,v)}}})();